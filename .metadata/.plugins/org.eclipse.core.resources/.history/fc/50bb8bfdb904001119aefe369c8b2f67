package com.revature.DAO;

	import java.sql.Connection;
	import java.sql.PreparedStatement;
	import java.sql.ResultSet;
	import java.util.ArrayList;
	import java.util.List;

import com.revature.model.PasswordEntry;
import com.revature.util.DBConnection;



	public class PasswordDAO {
		  // ---------------- ADD PASSWORD ----------------
	    public boolean addPassword(PasswordEntry entry) {

	        String sql =
	                "INSERT INTO passwords(user_id, account_name, username, password) " +
	                "VALUES (?, ?, ?, ?)";

	        try (Connection con = DBConnection.getConnection();
	             PreparedStatement ps = con.prepareStatement(sql)) {

	            ps.setInt(1, entry.getUserId());
	            ps.setString(2, entry.getAccountName());
	            ps.setString(3, entry.getUsername());
	            ps.setString(4, entry.getPassword());

	            return ps.executeUpdate() > 0;

	        } catch (Exception e) {
	            System.out.println("Database error while adding password");
	            return false;
	        }
	    }

	    // ---------------- VIEW ALL PASSWORDS ----------------
	    public List<PasswordEntry> getAllPasswords(int userId) {

	        List<PasswordEntry> list = new ArrayList<>();
	        String sql =
	                "SELECT account_name, username FROM passwords WHERE user_id=?";

	        try (Connection con = DBConnection.getConnection();
	             PreparedStatement ps = con.prepareStatement(sql)) {

	            ps.setInt(1, userId);
	            ResultSet rs = ps.executeQuery();

	            while (rs.next()) {
	                PasswordEntry entry = new PasswordEntry();
	                entry.setAccountName(rs.getString("account_name"));
	                entry.setUsername(rs.getString("username"));
	                list.add(entry);
	            }

	        } catch (Exception e) {
	            System.out.println(
	            		"Database error while fetching passwords for userId: " + userId);
	        }

	        return list;
	    }

	    // ---------------- VIEW SINGLE PASSWORD ----------------
	    public String getPasswordByAccount(int userId, String accountName) {

	        String sql =
	                "SELECT password FROM passwords WHERE user_id=? AND account_name=?";
	        String password = null;

	        try (Connection con = DBConnection.getConnection();
	             PreparedStatement ps = con.prepareStatement(sql)) {

	            ps.setInt(1, userId);
	            ps.setString(2, accountName);

	            ResultSet rs = ps.executeQuery();

	            if (rs.next()) {
	                password = rs.getString("password");
	            }

	        } catch (Exception e) {
	            System.out.println(
	                    "Database error while fetching password for userId: "
	                            + userId + ", account: " + accountName);
	        }

	        return password;
	    }

	    // ---------------- UPDATE PASSWORD ----------------
	    public boolean updatePassword(int userId,
	                                  String accountName,
	                                  String newPassword) {

	        String sql =
	                "UPDATE passwords SET password=? WHERE user_id=? AND account_name=?";

	        try (Connection con = DBConnection.getConnection();
	             PreparedStatement ps = con.prepareStatement(sql)) {

	            ps.setString(1, newPassword);
	            ps.setInt(2, userId);
	            ps.setString(3, accountName);

	            return ps.executeUpdate() > 0;

	        } catch (Exception e) {
	            System.out.println(
	                    "Database error while updating password for userId: "
	                            + userId + ", account: " + accountName);
	            return false;
	        }
	    }

	    // ---------------- DELETE PASSWORD ----------------
	    public boolean deletePassword(int userId, String accountName) {

	        String sql =
	                "DELETE FROM passwords WHERE user_id=? AND account_name=?";

	        try (Connection con = DBConnection.getConnection();
	             PreparedStatement ps = con.prepareStatement(sql)) {

	            ps.setInt(1, userId);
	            ps.setString(2, accountName);

	            return ps.executeUpdate() > 0;

	        } catch (Exception e) {
	            System.out.println(
	                    "Database error while deleting password for userId: "
	                            + userId + ", account: " + accountName);
	            return false;
	        }
	    }

	    // ---------------- SEARCH PASSWORDS ----------------
	    public List<PasswordEntry> searchPasswords(int userId, String keyword) {

	        List<PasswordEntry> list = new ArrayList<>();
	        String sql =
	                "SELECT account_name, username FROM passwords " +
	                "WHERE user_id=? AND account_name LIKE ?";

	        try (Connection con = DBConnection.getConnection();
	             PreparedStatement ps = con.prepareStatement(sql)) {

	            ps.setInt(1, userId);
	            ps.setString(2, "%" + keyword + "%");

	            ResultSet rs = ps.executeQuery();

	            while (rs.next()) {
	                PasswordEntry entry = new PasswordEntry();
	                entry.setAccountName(rs.getString("account_name"));
	                entry.setUsername(rs.getString("username"));
	                list.add(entry);
	            }

	        } catch (Exception e) {
	            System.out.println(
	                    "Error searching passwords for userId: " + userId);
	        }

	        return list;
	    }
	}

	}


